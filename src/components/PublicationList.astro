---
import publications from '../data/publications.json';
import labels from '../data/labels.json';

interface Props {
  lang: 'de' | 'en';
}

const { lang } = Astro.props;
const t = labels[lang];

function formatPublication(pub: any): string {
  let result = `<span class="publication-authors">${pub.authors}</span>: `;
  result += `<span class="publication-title">${pub.title}</span>`;

  if (pub.edition) {
    result += ` (${pub.edition})`;
  }

  if (pub.in) {
    result += `. In: ${pub.in}`;
  }

  if (pub.journal) {
    result += `. <em>${pub.journal}</em>`;
  }

  if (pub.volume) {
    result += `, ${pub.volume}`;
  }

  if (pub.pages) {
    result += `, S. ${pub.pages}`;
  }

  if (pub.publisher) {
    result += `. ${pub.publisher}`;
  }

  result += '.';
  return result;
}
---

<section id={lang === 'de' ? 'publikationen' : 'publications'} class="py-16">
  <div class="container-narrow">
    <h2 class="section-title">{t.sections.publications}</h2>

    {publications.publications.map((yearGroup) => (
      <div class="mb-8">
        <h3 class="text-xl font-serif text-primary-800 mb-4">{yearGroup.year}</h3>
        <div class="space-y-1">
          {yearGroup.entries.map((pub) => (
            <div class="publication-entry">
              <p class="text-sm leading-relaxed" set:html={formatPublication(pub)} />
            </div>
          ))}
        </div>
      </div>
    ))}

    <h2 class="section-title mt-12">{t.sections.departmentPublications}</h2>

    {publications.departmentPublications.map((yearGroup) => (
      <div class="mb-8">
        <h3 class="text-xl font-serif text-primary-800 mb-4">{yearGroup.year}</h3>
        <div class="space-y-1">
          {yearGroup.entries.map((pub) => (
            <div class="publication-entry">
              <p class="text-sm leading-relaxed" set:html={formatPublication(pub)} />
            </div>
          ))}
        </div>
      </div>
    ))}
  </div>
</section>
